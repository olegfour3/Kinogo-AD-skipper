// ==UserScript==
// @name         Kinogo.inc –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ü—Ä–æ–ø—É—Å–∫ –†–µ–∫–ª–∞–º—ã
// @namespace    http://tampermonkey.net/
// @version      2.3.0
// @icon            https://github.com/olegfour3/Kinogo-AD-skipper/raw/main/assets/favicon.png
// @updateURL       https://github.com/olegfour3/Kinogo-AD-skipper/raw/main/userscript/kinogo-ad-skipper.user.js
// @downloadURL     https://github.com/olegfour3/Kinogo-AD-skipper/raw/main/userscript/kinogo-ad-skipper.user.js
// @description  –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç VAST —Ä–µ–∫–ª–∞–º—É –Ω–∞ kinogo —Å–∞–π—Ç–∞—Ö —Å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–º –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ–º
// @author       olegfour3
// @match        https://kinogo.*/*
// @match        https://*.kinogo.*/*
// @match        https://*.allarknow.online/*
// @match        https://*.srv224.com/*
// @match        https://*.adstag0102.xyz/*
// @match        https://*.adstag*.*/*
// @grant        none
// ==/UserScript==
(function() {
    'use strict';

    console.log('Kinogo AD Skipper: –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω');

    let config = {
        maxAdDuration: 180, // 3 –º–∏–Ω—É—Ç—ã
        skipOffset: 0.3,    // –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –∑–∞ 0.3 —Å–µ–∫ –¥–æ –∫–æ–Ω—Ü–∞
        checkInterval: 500, // –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–∞–∂–¥—ã–µ 0.5 —Å–µ–∫—É–Ω–¥—ã
        debug: false
    };

    let state = {
        isProcessing: false,
        processedVideos: new Set(),
        lastCheck: 0,
        adCount: 0,
        vastPlayer: null,
        rmpVastInstance: null
    };

    function log(message) {
        if (config.debug) {
            console.log(`[Ad Skipper] ${message}`);
        }
    }

    // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º VAST —Å–æ–±—ã—Ç–∏—è
    function interceptVastEvents() {
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.log –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è VAST —Å–æ–±—ã—Ç–∏–π
        const originalLog = console.log;
        console.log = function(...args) {
            const message = args.join(' ');
            
            // –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ–º –Ω–∞—á–∞–ª–æ —Ä–µ–∫–ª–∞–º—ã
            if (message.includes('RMP-VAST: API EVENT - adstarted')) {
                log('üéØ VAST —Ä–µ–∫–ª–∞–º–∞ –Ω–∞—á–∞–ª–∞—Å—å!');
                setTimeout(() => {
                    const adVideo = findAdVideo();
                    if (adVideo) {
                        skipVastAd(adVideo);
                    }
                }, 100);
            }
            
            // –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            if (message.includes('durationAds ')) {
                const duration = parseFloat(message.split('durationAds ')[1]);
                if (duration && duration < config.maxAdDuration * 1000) {
                    log(`üìä –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ VAST —Ä–µ–∫–ª–∞–º–∞ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é: ${(duration/1000).toFixed(1)}—Å`);
                }
            }
            
            originalLog.apply(console, args);
        };
    }

    function findAdVideo() {
        // –ò—â–µ–º VAST —Ä–µ–∫–ª–∞–º–Ω–æ–µ –≤–∏–¥–µ–æ –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º —Å–µ–ª–µ–∫—Ç–æ—Ä–∞–º
        const adSelectors = [
            '.rmp-ad-vast-video-player',
            'video[src*="adstag"]',
            'video[src*="cdn3.adstag"]',
            '.rmp-ad-container video',
            '.allplay__ads video',
            'video.rmp-ad-vast-video-player'
        ];

        for (const selector of adSelectors) {
            const video = document.querySelector(selector);
            if (video && video.duration > 0) {
                log(`üé¨ –ù–∞–π–¥–µ–Ω–æ —Ä–µ–∫–ª–∞–º–Ω–æ–µ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä: ${selector}`);
                return video;
            }
        }

        // –ü–æ–∏—Å–∫ –≤ iframe
        const iframes = document.querySelectorAll('iframe');
        for (const iframe of iframes) {
            try {
                if (iframe.contentDocument) {
                    for (const selector of adSelectors) {
                        const video = iframe.contentDocument.querySelector(selector);
                        if (video && video.duration > 0) {
                            log(`üé¨ –ù–∞–π–¥–µ–Ω–æ —Ä–µ–∫–ª–∞–º–Ω–æ–µ –≤–∏–¥–µ–æ –≤ iframe: ${selector}`);
                            return video;
                        }
                    }
                }
            } catch (e) {
                // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ iframe
            }
        }

        return null;
    }

    function isAdVideo(video) {
        const duration = video.duration;
        const src = video.src || video.currentSrc;
        
        // –û—Å–Ω–æ–≤–Ω–æ–π –∫—Ä–∏—Ç–µ—Ä–∏–π - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–µ–Ω—å—à–µ 3 –º–∏–Ω—É—Ç
        if (duration > 0 && duration < config.maxAdDuration) {
            return true;
        }

        // VAST —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
        const vastIndicators = [
            'adstag', 'vast', 'preroll', 'midroll', 'postroll', 
            'ad-', 'ads-', 'advertisement', 'commercial', 'sponsor',
            'rmp-ad', 'allplay__ads'
        ];

        const videoClasses = video.className.toLowerCase();
        const videoId = video.id.toLowerCase();
        const srcLower = src.toLowerCase();

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ –∫–ª–∞—Å—Å–∞–º, ID –∏ src
        if (vastIndicators.some(indicator => 
            videoClasses.includes(indicator) || 
            videoId.includes(indicator) ||
            srcLower.includes(indicator)
        )) {
            return true;
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∏–¥–µ–æ
        const container = video.closest('.rmp-ad-container, .allplay__ads, [class*="ad-"], [class*="ads-"], [class*="vast"]');
        if (container) {
            return true;
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ src URL
        if (src.includes('adstag') || src.includes('ads.') || src.includes('/ads/')) {
            return true;
        }

        return false;
    }

    function skipVastAd(video) {
        const duration = video.duration;
        const skipTime = Math.max(0, duration - config.skipOffset);
        
        log(`‚ö° –ü—Ä–æ–ø—É—Å–∫–∞–µ–º VAST —Ä–µ–∫–ª–∞–º—É –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é ${duration.toFixed(1)}—Å`);
        
        try {
            // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –ø—Ä–æ–ø—É—Å–∫–∞
            video.currentTime = skipTime;
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∏ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É –ø—Ä–æ–ø—É—Å–∫–∞
            const skipButtons = [
                '.rmp-ad-container .skip-button',
                '.allplay__skip',
                '[data-allplay="skip"]',
                '.ad-skip-button'
            ];
            
            for (const selector of skipButtons) {
                const button = document.querySelector(selector);
                if (button && button.offsetParent !== null) {
                    log(`üñ±Ô∏è –ù–∞–π–¥–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –ø—Ä–æ–ø—É—Å–∫–∞: ${selector}`);
                    button.click();
                    break;
                }
            }
            
            state.adCount++;
            
            const videoId = getVideoId(video);
            state.processedVideos.add(videoId);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showSkipNotification(duration, 'VAST');
            
        } catch (error) {
            log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–ø—É—Å–∫–µ VAST —Ä–µ–∫–ª–∞–º—ã: ${error.message}`);
        }
    }

    function skipAd(video) {
        const duration = video.duration;
        const skipTime = Math.max(0, duration - config.skipOffset);
        
        log(`‚ö° –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—ã—á–Ω—É—é —Ä–µ–∫–ª–∞–º—É –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é ${duration.toFixed(1)}—Å`);
        
        video.currentTime = skipTime;
        state.adCount++;
        
        showSkipNotification(duration, '–û–±—ã—á–Ω–∞—è');
        
        const videoId = getVideoId(video);
        state.processedVideos.add(videoId);
    }

    function getVideoId(video) {
        return video.src || video.currentSrc || video.outerHTML.substring(0, 100);
    }

    function checkAndSkipAds() {
        if (state.isProcessing) return;
        
        const now = Date.now();
        if (now - state.lastCheck < config.checkInterval) return;
        
        state.lastCheck = now;
        state.isProcessing = true;

        try {
            // –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º VAST —Ä–µ–∫–ª–∞–º—É
            const vastVideo = findAdVideo();
            if (vastVideo && vastVideo.duration > 0 && vastVideo.duration < config.maxAdDuration) {
                const videoId = getVideoId(vastVideo);
                if (!state.processedVideos.has(videoId)) {
                    skipVastAd(vastVideo);
                    return;
                }
            }

            // –ó–∞—Ç–µ–º –æ–±—ã—á–Ω—ã–µ –≤–∏–¥–µ–æ
            const allVideos = findAllVideos();
            
            allVideos.forEach(video => {
                if (!video || video.readyState < 1) return;
                
                const videoId = getVideoId(video);
                if (state.processedVideos.has(videoId)) return;
                
                const duration = video.duration;
                const currentTime = video.currentTime;
                
                if (isNaN(duration) || duration <= 0) return;
                
                log(`üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–µ–æ: ${duration.toFixed(1)}—Å, –ø–æ–∑–∏—Ü–∏—è: ${currentTime.toFixed(1)}—Å`);
                
                if (isAdVideo(video)) {
                    skipAd(video);
                } else {
                    // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–µ –≤–∏–¥–µ–æ (–Ω–µ —Ä–µ–∫–ª–∞–º–∞)
                    if (duration > config.maxAdDuration) {
                        state.processedVideos.add(videoId);
                        log(`‚úÖ –û—Å–Ω–æ–≤–Ω–æ–µ –≤–∏–¥–µ–æ: ${duration.toFixed(1)}—Å`);
                    }
                }
            });
        } catch (error) {
            log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ: ${error.message}`);
        } finally {
            state.isProcessing = false;
        }
    }

    function findAllVideos() {
        const videos = [];
        
        // –í–∏–¥–µ–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ
        videos.push(...document.querySelectorAll('video'));
        
        // –í–∏–¥–µ–æ –≤ iframe
        const iframes = document.querySelectorAll('iframe');
        iframes.forEach(iframe => {
            try {
                if (iframe.contentDocument) {
                    videos.push(...iframe.contentDocument.querySelectorAll('video'));
                }
            } catch (e) {
                // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ iframe
            }
        });
        
        return videos;
    }

    function showSkipNotification(duration, type = '–†–µ–∫–ª–∞–º–∞') {
        log(`üîî –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: ${type} (${duration.toFixed(1)}—Å)`);
        try {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–µ–ª–µ–≤–æ–π –¥–æ–∫—É–º–µ–Ω—Ç - –≤—Å–µ–≥–¥–∞ –ø—ã—Ç–∞–µ–º—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –æ–∫–Ω–æ
            let targetDoc, targetBody;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏–º—Å—è –ª–∏ –º—ã –≤ iframe
            const isInIframe = window !== window.parent;
            log(`üìç –ù–∞—Ö–æ–¥–∏–º—Å—è –≤ iframe: ${isInIframe}`);
            
            if (isInIframe) {
                try {
                    // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º—É –æ–∫–Ω—É
                    targetDoc = window.parent.document;
                    targetBody = targetDoc.body;
                    log(`üéØ –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –æ–∫–Ω–æ`);
                } catch (e) {
                    log(`‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º—É –æ–∫–Ω—É: ${e.message}`);
                    // –ï—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞, –ø—ã—Ç–∞–µ–º—Å—è —á–µ—Ä–µ–∑ postMessage
                    try {
                        window.parent.postMessage({
                            type: 'AD_SKIPPED',
                            duration: duration,
                            adType: type,
                            count: state.adCount
                        }, '*');
                        log(`üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –æ–∫–Ω–æ`);
                        return;
                    } catch (postError) {
                        log(`‚ùå –û—à–∏–±–∫–∞ postMessage: ${postError.message}`);
                        targetDoc = document;
                        targetBody = document.body;
                    }
                }
            } else {
                // –ú—ã –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –æ–∫–Ω–µ
                targetDoc = document;
                targetBody = document.body;
                log(`üè† –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ –æ–∫–Ω–æ`);
            }
            
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            const existingNotifications = targetDoc.querySelectorAll('.ad-skip-notification');
            existingNotifications.forEach(n => n.remove());
            
            const notification = targetDoc.createElement('div');
            notification.className = 'ad-skip-notification';
            notification.innerHTML = `
                <div style="
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #28a745, #20c997);
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    z-index: 999999;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                    font-size: 14px;
                    font-weight: 500;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                    animation: slideIn 0.3s ease-out;
                    border: 1px solid rgba(255,255,255,0.2);
                ">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="font-size: 18px;">‚ö°</div>
                        <div>
                            <div>${type} –ø—Ä–æ–ø—É—â–µ–Ω–∞</div>
                            <div style="font-size: 12px; opacity: 0.8;">
                                ${Math.round(duration)}—Å ‚Ä¢ –í—Å–µ–≥–æ: ${state.adCount}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º CSS –∞–Ω–∏–º–∞—Ü–∏–∏
            if (!targetDoc.querySelector('#ad-skipper-styles')) {
                const styles = targetDoc.createElement('style');
                styles.id = 'ad-skipper-styles';
                styles.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                targetDoc.head.appendChild(styles);
            }
            
            targetBody.appendChild(notification);
            log(`‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ ${targetDoc === document ? '—Ç–µ–∫—É—â–µ–µ' : '—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ'} –æ–∫–Ω–æ`);

            // –£–±–∏—Ä–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOut 0.3s ease-in';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 3000);
            
        } catch (error) {
            // –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –ª–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
            log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: ${error.message}`);
            
            // –ü—Ä–æ—Å—Ç–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ console –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            console.log(`üéØ Ad Skipper: ${type} –ø—Ä–æ–ø—É—â–µ–Ω–∞ (${Math.round(duration)}—Å) ‚Ä¢ –í—Å–µ–≥–æ: ${state.adCount}`);
        }
    }

    function observeChanges() {
        const observer = new MutationObserver((mutations) => {
            let shouldCheck = false;
            
            mutations.forEach((mutation) => {
                if (mutation.type === 'childList') {
                    mutation.addedNodes.forEach((node) => {
                        if (node.nodeType === 1) {
                            if (node.tagName === 'VIDEO' || 
                                node.tagName === 'IFRAME' ||
                                (node.querySelector && 
                                 (node.querySelector('video') || node.querySelector('iframe'))) ||
                                (node.className && node.className.includes('rmp-ad'))) {
                                shouldCheck = true;
                            }
                        }
                    });
                }
            });

            if (shouldCheck) {
                log('üîÑ –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –Ω–æ–≤—ã–µ –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç—ã');
                setTimeout(checkAndSkipAds, 200);
            }
        });

        observer.observe(document.body, {
            childList: true,
            subtree: true
        });

        return observer;
    }

    function setupMessageListener() {
        // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç iframe –æ –ø—Ä–æ–ø—É—Å–∫–µ —Ä–µ–∫–ª–∞–º—ã
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'AD_SKIPPED') {
                log(`üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–æ–ø—É—Å–∫–µ —Ä–µ–∫–ª–∞–º—ã –∏–∑ iframe`);
                const { duration, adType, count } = event.data;
                
                // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –æ–∫–Ω–µ
                createNotificationInMainWindow(duration, adType, count);
            }
        });
    }

    function createNotificationInMainWindow(duration, type, count) {
        log(`üîî –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –æ–∫–Ω–µ: ${type} (${duration.toFixed(1)}—Å)`);
        
        // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        const existingNotifications = document.querySelectorAll('.ad-skip-notification');
        existingNotifications.forEach(n => n.remove());
        
        const notification = document.createElement('div');
        notification.className = 'ad-skip-notification';
        notification.innerHTML = `
            <div style="
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #28a745, #20c997);
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 999999;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                font-size: 14px;
                font-weight: 500;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease-out;
                border: 1px solid rgba(255,255,255,0.2);
            ">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div style="font-size: 18px;">‚ö°</div>
                    <div>
                        <div>${type} –ø—Ä–æ–ø—É—â–µ–Ω–∞</div>
                        <div style="font-size: 12px; opacity: 0.8;">
                            ${Math.round(duration)}—Å ‚Ä¢ –í—Å–µ–≥–æ: ${count}
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // –î–æ–±–∞–≤–ª—è–µ–º CSS –∞–Ω–∏–º–∞—Ü–∏–∏
        if (!document.querySelector('#ad-skipper-styles')) {
            const styles = document.createElement('style');
            styles.id = 'ad-skipper-styles';
            styles.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(styles);
        }
        
        document.body.appendChild(notification);
        log(`‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–µ –æ–∫–Ω–æ`);

        // –£–±–∏—Ä–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
        setTimeout(() => {
            if (notification.parentNode) {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }
        }, 3000);
    }

    function init() {
        log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–º–Ω–æ–≥–æ –ø—Ä–æ–ø—É—Å–∫–∞ —Ä–µ–∫–ª–∞–º—ã...');
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏–π (—Ç–æ–ª—å–∫–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –æ–∫–Ω–µ)
        if (window === window.parent) {
            setupMessageListener();
            log('üìª –ù–∞—Å—Ç—Ä–æ–µ–Ω —Å–ª—É—à–∞—Ç–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –æ–∫–Ω–µ');
        }
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º VAST —Å–æ–±—ã—Ç–∏—è
        interceptVastEvents();
        
        // –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ (—á–∞—â–µ –¥–ª—è VAST)
        setInterval(checkAndSkipAds, config.checkInterval);
        
        // –ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ DOM
        observeChanges();
        
        // –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–±—Ä–∞–Ω–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        // setTimeout(addControlPanel, 2000);
        
        // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
        setTimeout(checkAndSkipAds, 500);
        
        log('‚úÖ –£–º–Ω—ã–π –ø—Ä–æ–ø—É—Å–∫ —Ä–µ–∫–ª–∞–º—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
        log('üìã –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è: VAST —Ä–µ–∫–ª–∞–º–∞, –æ–±—ã—á–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞, RMP –ø–ª–µ–µ—Ä');
    }

    // –ó–∞–ø—É—Å–∫
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }

})(); 